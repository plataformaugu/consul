<% content_for :body_class, "home-page" %>

<% content_for :canonical do %>
  <%= render "shared/canonical", href: root_url %>
<% end %>

<%= render Shared::BannerComponent.new("homepage") %>

<% provide :social_media_meta_tags do %>
  <%= render "shared/social_media_meta_tags",
              social_url: root_url %>
<% end %>

<%= render "shared/header", header: @header %>

<% if !current_user or (current_user and !Poll.find(1).voters.pluck(:user_id).include?(current_user.id)) %>
<div class="reveal reveal-popup" id="popupModal" data-reveal>
  <a href="/polls/1" data-turbolinks="false">
    <%= image_tag('/images/popup.png') %>
  </a>
  <button class="close-button" data-close aria-label="Close modal" type="button" style="color: white;">
    <span aria-hidden="true">&times;</span>
  </button>
</div>
<% end %>

<main>
  <div class="home-proposals">
    <div class="home-proposals-container" id="hot-proposals">
      <h1>Revisa los procesos destacados</h1>

      <div class="home-proposals-cards">
        <%= render 'temp_cards' %>
      </div>
    </div>


    <div class="separator">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="#2e4ac7" fill-opacity="1" d="M0,224L60,234.7C120,245,240,267,360,256C480,245,600,203,720,176C840,149,960,139,1080,138.7C1200,139,1320,149,1380,154.7L1440,160L1440,320L1380,320C1320,320,1200,320,1080,320C960,320,840,320,720,320C600,320,480,320,360,320C240,320,120,320,60,320L0,320Z"></path></svg>
    </div>
    
    <%= image_tag "/images/mujer-megafono.svg", class: 'image-background' %>
  </div>

  <div class="home-steps">
    <div class="home-steps-container">
      <h1>Paso a paso para participar</h1>

      <div class="home-steps-cards">
        <%= link_to new_user_registration_path, style: 'text-decoration: none;' do %>
        <div class="home-steps-card-container-1 bg-color-1">
          <div class="home-steps-card color-1">
            <h1>1</h1>
            <p>Crea tu <br><strong>usuario</strong></p>
            <div class="plus-button plus-btn-color-1"></div>
          </div>
        </div>
        <% end %>
        <%= link_to '/participar', style: 'text-decoration: none;' do %>
        <div class="home-steps-card-container-2 bg-color-2">
          <div class="home-steps-card color-2">
            <h1>2</h1>
            <p>Revisa las <br><strong>formas de <br>participar</strong></p>
            <div class="plus-button plus-btn-color-2"></div>
          </div>
        </div>
        <% end %>
        <%= link_to '#hot-proposals', style: 'text-decoration: none;' do %>
        <div class="home-steps-card-container-3 bg-color-3">
          <div class="home-steps-card color-3">
            <h1>3</h1>
            <p>Vota y crea<br> una <strong>mejor <br>comuna</strong></p>
            <div class="plus-button plus-btn-color-3"></div>
          </div>
        </div>
        <% end %>
      </div>
    </div>
    <div class="separator" style="background-color: #2e4ac7; position: relative;">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 250"><path fill="#2e4ac7" fill-opacity="1" d="M0,160L60,176C120,192,240,224,360,213.3C480,203,600,149,720,122.7C840,96,960,96,1080,106.7C1200,117,1320,139,1380,149.3L1440,160L1440,0L1380,0C1320,0,1200,0,1080,0C960,0,840,0,720,0C600,0,480,0,360,0C240,0,120,0,60,0L0,0Z"></path></svg>
      <%= image_tag '/images/arbol-gris.svg', class: 'desktop-only', style: 'position: absolute; bottom: 0; left: 10%; height: 300px; mix-blend-mode: multiply; height: 200px !important;' %>
      <%= image_tag '/images/arbusto-gris.svg', class: 'desktop-only', style: 'position: absolute; bottom: 0; left: 60%; width: 20%; mix-blend-mode: multiply;' %>
    </div>
  </div>

  <% if true == false %>
    <div class="home-data" id="home-data">
      <div class="h-d-container">
        <h1>Datos relevantes de la comuna</h1>
        <div class="h-d-cards">

          <div class="h-d-card">
            <div class="h-d-c-circle">
              <h2 class="h-d-c-count">294000</h2>
            </div>
            <div class="h-d-c-text">
              <h4>Habitantes <br><strong>de la comuna</strong></h4>
            </div>
          </div>

          <div class="h-d-card">
            <div class="h-d-c-circle">
              <h2 class="h-d-c-count">99</h2>
            </div>
            <div class="h-d-c-text">
              <h4>Km² <br><strong>Superficie</strong></h4>
            </div>
          </div>

          <div class="h-d-card">
            <div class="h-d-c-circle">
              <h2 class="h-d-c-count">121</h2>
            </div>
            <div class="h-d-c-text">
              <h4>Años creación <br><strong>de la comuna</strong></h4>
            </div>
          </div>

          <div class="h-d-card">
            <div class="h-d-c-circle">
              <h2 class="h-d-c-count">8</h2>
            </div>
            <div class="h-d-c-text">
              <h4>Plazas con <br><strong>Canil</strong></h4>
            </div>
          </div>
    
        </div>
      </div>
      <div class="separator">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 250"><path fill="#c93358" fill-opacity="1" d="M0,160L60,176C120,192,240,224,360,213.3C480,203,600,149,720,122.7C840,96,960,96,1080,106.7C1200,117,1320,139,1380,149.3L1440,160L1440,0L1380,0C1320,0,1200,0,1080,0C960,0,840,0,720,0C600,0,480,0,360,0C240,0,120,0,60,0L0,0Z"></path></svg>
      </div>
    </div>

    <div class="home-social">
      <div class="h-s-container">
        <div class="h-s-c-text">
          <h1>¡Tu opinión nos interesa!</h1>
          <p>Revisa lo que opinan nuestros vecinos</p>
        </div>
        <div class="h-s-c-cards">

          <div>
            <div class="h-s-c-card">
              <div class="h-s-c-c-body">
                Ahora el barrio es mucho más seguro!!
              </div>
              <div class="h-s-c-c-footer">
                <div>
                  <strong>Cata Perez</strong><br>
                  Vecina Unidad Vecinal B2
                </div>
                <div>
                  * * *
                </div>
              </div>
            </div>
          </div>

          <div>
            <div class="h-s-c-card">
              <div class="h-s-c-c-body">
                Nos deja muy contentos este arreglo que
                hicieron en el parque al lado de nuestras
                casa, asi con la iluminación nueva es
                mucho mas seguro
              </div>
              <div class="h-s-c-c-footer">
                <div>
                  <strong>Carolina Rodriguez</strong><br>
                  Vecina Unidad Vecinal C6
                </div>
                <div>
                  * * *
                </div>
              </div>
            </div>
          </div>

          <div>
            <div class="h-s-c-card">
              <div class="h-s-c-c-body">
                Estoy orgullosa de haber propuesto esta
                mejora en la comuna fue muy fácil de
                hacerlo.
              </div>
              <div class="h-s-c-c-footer">
                <div>
                  <strong>Alicia Vasquez</strong><br>
                  Vecina Unidad Vecinal A1
                </div>
                <div>
                  * * *
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <%= image_tag "/images/joven-datos.svg", class: 'image-background' %>
    </div>
  <% end %>
</main>

<script>
$.fn.isInViewport = function () {
    let elementTop = $(this).offset().top;
    let elementBottom = elementTop + $(this).outerHeight();

    let viewportTop = $(window).scrollTop();
    let viewportBottom = viewportTop + $(window).height();

    return elementBottom > viewportTop && elementTop < viewportBottom;
};

var isSeen = false;

$(window).scroll(function () {
    if ($('#home-data').isInViewport() && !isSeen) {
      isSeen = true;
      $('.h-d-c-count').each(function () {
          $(this).prop('Counter',0).animate({
              Counter: $(this).text()
          }, {
              duration: 4000,
              easing: 'swing',
              step: function (now) {
                  $(this).text(Math.ceil(now).toLocaleString());
              }
          });
      });
    }
});

$(document).ready(function() {
  $('#popupModal').foundation('open');
})
</script>