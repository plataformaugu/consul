<ul class="tabs" data-tabs id="example-tabs">
  <li class="tabs-title is-active"><a href="#panel1" aria-selected="true">Gestión de usuarios</a></li>
  <li class="tabs-title"><a data-tabs-target="panel2" href="#panel2">
    Sin coordenadas
    <span class="badge secondary">
      <%= User.where(lat: nil, long: nil).filter{|x| x.comuna.to_s.downcase.include? 'condes' }.count %>
    </span>
  </a></li>
</ul>


<div class="tabs-content" data-tabs-content="example-tabs">
  <div class="tabs-panel is-active" id="panel1">
    <%= render "shared/filter_subnav", i18n_namespace: "admin.users.index" %>

    <% if @users.any? %>
      <h3><%= page_entries_info @users %></h3>

      <table>
        <thead>
          <tr>
            <% if @current_filter == "erased" %>
              <th scope="col"><%= t("admin.users.columns.id") %></th>
              <th scope="col"><%= t("admin.users.columns.erase_reason") %></th>
            <% else %>
              <th scope="col"><%= t("admin.users.columns.name") %></th>
              <th scope="col"><%= t("admin.users.columns.email") %></th>
              <th scope="col"><%= t("admin.users.columns.document_number") %></th>
              <th scope="col"><%= t("admin.users.columns.roles") %></th>
              <th scope="col"><%= t("admin.users.columns.verification_level") %></th>
            <% end %>
          </tr>
        </thead>
        <tbody>
          <% @users.each do |user| %>
            <tr>
              <% if @current_filter == "erased" %>
                <td><%= link_to user.id, user_path(user), target: "_blank" %></td>
                <td><%= user.erase_reason %></td>
              <% else %>
                <td><%= link_to user.first_name && user.last_name ? "#{user.first_name} #{user.last_name}" : user.name, user_path(user), target: "_blank" %></td>
                <td><%= user.email %></td>
                <td><%= user.document_number %></td>
                <td><%= display_user_roles(user) %></td>
                <td><%= user.user_type %></td>
              <% end %>
            </tr>
          <% end %>
        </tbody>
      </table>

      <%= paginate @users %>
    <% else %>
      <div class="callout primary">
        <%= t("admin.users.index.no_users") %>
      </div>
    <% end %>
      </div>
  <div class="tabs-panel" id="panel2">
    <p>Aquí se muestran los usuarios que viven en Las Condes y no se les pudo asignar coordenadas dentro de la comuna para segmentarlos por sector.</p>
    
    <% if User.where(lat: nil, long: nil).filter{|x| x.comuna.to_s.downcase.include? 'condes' }.any? %>
      <table>
        <thead>
          <tr>
            <th scope="col"><%= t("admin.users.columns.name") %></th>
            <th scope="col"><%= t("admin.users.columns.email") %></th>
            <th scope="col">Calle</th>
            <th scope="col">Número</th>
          </tr>
        </thead>
        <tbody>
          <% User.where(lat: nil, long: nil).filter{|x| x.comuna.to_s.downcase.include? 'condes' }.each do |user| %>
            <tr>
              <td><%= link_to "#{user.first_name} #{user.last_name}", user_path(user), target: "_blank" %></td>
              <td><%= user.email %></td>
              <td><%= user.street %></td>
              <td><%= user.house_number %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% else %>
      <div class="callout primary">
        <%= t("admin.users.index.no_users") %>
      </div>
    <% end %>
  </div>
</div>

