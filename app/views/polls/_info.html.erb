<div class="proposal-info">
  <%= l poll.created_at.to_date %>
</div>

<div class="proposal-content-container">
  <div class="p-c-duo">
    <div>
      <blockquote><%= poll.summary %></blockquote>

      <div class="p-c-description">
      <%= auto_link_already_sanitized_html wysiwyg(poll.description) %>
      </div>
    </div>
    <div style="display: flex; flex-direction: column; align-items: center;">
      <div class="info-card">
        <div class="info-card-header" style="background-color: #f25b86;">
          <h1>Vota</h1>
        </div>
        <div class="info-card-body">
          <p><%= poll.title %></p>

            <div style="display: flex; flex-direction: column;">
              <% @questions.each do |question| %>
                <%= render "polls/questions/question", question: question, token: @token %>
              <% end %>
            </div>
        </div>

        <% unless current_user %>
        <div class="info-card-footer">
          <p>Necesitas <span style="color: #5eb7d9;"><%= link_to "iniciar sesión", new_user_session_path %></span> o <span style="color: #5eb7d9;"><%= link_to "registrarte", new_user_registration_path %></span> para participar</p>
        </div>
        <% end %>
      </div>
      <% if poll.image.present? %>
        <div style="margin-top: 50px;">
        <%= image_tag poll.image_url(:original) %>
        </div>
      <% end %>
      <% if poll.sectors.any? %>
      <div class="custom-icon-message mt-3" style="background-color: #f25b86;">
        <div class="c-i-m-left" style="background-color: #f25b86;">
          !
        </div>
        <div class="c-i-m-right" style="background-color: #f25b86;">
          Este proceso está habilitado solo para <br>residentes de la(s) unidad(es) vecinal(es):<br>
          <strong><%= poll.sectors.map{ |s| s.name }.join(', ') %>.</strong>
        </div>
      </div>
      <% else %>
        <% if Set.new(['Vecino Residente Las Condes']) == Set.new(poll.neighbor_types.pluck(:name)) %>
          <div class="custom-icon-message mt-3" style="background-color: #f25b86;">
            <div class="c-i-m-left" style="background-color: #f25b86;">
              !
            </div>
            <div class="c-i-m-right" style="background-color: #f25b86;">
              Este proceso está habilitado solo para<br>
              <strong>vecinos residentes.</strong>
            </div>
          </div>
        <% elsif Set.new(['Vecino Residente Las Condes', 'Vecino Flotante Las Condes']) == Set.new(poll.neighbor_types.pluck(:name)) %>
          <div class="custom-icon-message mt-3" style="background-color: #f25b86;">
            <div class="c-i-m-left" style="background-color: #f25b86;">
              !
            </div>
            <div class="c-i-m-right" style="background-color: #f25b86;">
              Este proceso está habilitado solo para<br>
              <strong>vecinos residentes y flotantes.</strong>
            </div>
          </div>
        <% elsif Set.new(['Vecino Flotante Las Condes']) == Set.new(poll.neighbor_types.pluck(:name)) %>
          <div class="custom-icon-message mt-3" style="background-color: #f25b86;">
            <div class="c-i-m-left" style="background-color: #f25b86;">
              !
            </div>
            <div class="c-i-m-right" style="background-color: #f25b86;">
              Este proceso está habilitado solo para<br>
              <strong>vecinos flotantes.</strong>
            </div>
          </div>
        <% end %>
      <% end %>
    </div>
  </div>

  <div id="poll_more_info_answers" class="expanded poll-more-info-answers mt-3">
    <div class="row padding">
      <% @questions.each do |question| %>
        <% if question.question_answers.filter{|a| a.description.present?}.any? %>
          <div>
          <h3><%= question.title %></h3>
          
          <% question.question_answers.each do |qa| %>
            <h4><%= qa.title %></h4>
            <p><%= wysiwyg(qa.description) %></p>
            <div class="row">
              <div class="small-12 medium-6 column">
                <% if qa.images.any? %>
                  <%= render "gallery", answer: qa %>
                <% end %>
              </div>
              <div class="small-12 medium-6 column">
                <% if qa.documents.present? %>
                  <div class="document-link">
                    <p>
                      <span class="icon-document"></span>&nbsp;
                      <strong><%= t("polls.show.documents") %></strong>
                    </p>

                    <% qa.documents.each do |document| %>
                        <%= link_to document.title,
                                    document.attachment.url,
                                    target: "_blank",
                                    rel: "nofollow" %><br>
                    <% end %>
                  </div>
                <% end %>

                <% if qa.videos.present? %>
                  <div class="video-link">
                    <p>
                      <span class="icon-video"></span>&nbsp;
                      <strong><%= t("polls.show.videos") %></strong>
                    </p>

                    <% qa.videos.each do |video| %>
                        <%= link_to video.title,
                                    video.url,
                                    target: "_blank",
                                    rel: "nofollow" %><br>
                    <% end %>
                  </div>
                <% end %>
              </div>
            </div>
          <% end %>

          </div>
          <% if question != @questions.last %>
            <hr>
          <% end %>
        <% end %>
      <% end %>
    </div>
  </div>
</div>
